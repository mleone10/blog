<!doctype html><html><head><link rel=stylesheet href=/css/ditalini.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><title>Mario Leone | Test What Matters</title></head><body><nav class="mainNav fullWidth"><h1><a href=https://mleone.dev>Mario Leone</a></h1><ul><li><a href=/about/>About Me</a></li><li><a href=https://mleone.dev/tags/>Tags</a></li></ul></nav><main><article class="single h-entry"><header><h2><a class="p-name u-url" href=https://mleone.dev/posts/test-what-matters/>Test What Matters</a></h2><span class=byline><a class="p-author h-card" href=https://mleone.dev>Mario Leone</a>
&#183;&nbsp;<time class=dt-published datetime=2021-06-01T15:22:03-0400>
June 1, 2021</time>
&#183;
<a class=p-category href=https://mleone.dev/tags/tech/>Tech</a>, <a class=p-category href=https://mleone.dev/tags/software-craftsmanship/>Software Craftsmanship</a></span></header><div class=e-content><p>I write a decent amount of Java at work. A lot of the code we write looks something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Imports omitted
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FooService</span> <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FooService</span><span style=color:#f92672>(</span>BarUtil barUtil<span style=color:#f92672>,</span> ApiUtil apiUtil<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>barUtil</span> <span style=color:#f92672>=</span> barUtil<span style=color:#f92672>;</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>apiUtil</span> <span style=color:#f92672>=</span> apiUtil<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>performBar</span><span style=color:#f92672>(</span>String fizz<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        String buzz <span style=color:#f92672>=</span> barUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>bar</span><span style=color:#f92672>(</span>fizz<span style=color:#f92672>);</span>

        Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> foo <span style=color:#f92672>=</span> Optional<span style=color:#f92672>.</span><span style=color:#a6e22e>empty</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
            foo <span style=color:#f92672>=</span> Optional<span style=color:#f92672>.</span><span style=color:#a6e22e>ofNullable</span><span style=color:#f92672>(</span>apiUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>callFooApi</span><span style=color:#f92672>(</span>buzz<span style=color:#f92672>).</span><span style=color:#a6e22e>getBody</span><span style=color:#f92672>());</span>
        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>RestException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>throw</span> FooServiceException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;problem calling Foo API&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>

        <span style=color:#66d9ef>return</span> foo<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Basically, we have services that do some logic, call an API, and hopefully return some data. Fairly straightforward.</p><p>For the purposes of this example, let&rsquo;s say that <code>BarUtil</code> is a convenient utility class that does a lookup based on the value of <code>fizz</code>. The specifics don&rsquo;t matter, only that the call to <code>barUtil.bar()</code> has no side effects - we only care about the returned value.</p><p>My question is this: <strong>should the unit tests for <code>FooService</code> perform any verification on the call to <code>barUtil.bar()</code>?</strong></p><p>No!</p><p>The correctness of <code>FooService</code> and its <code>performBar()</code> method relies on two things:</p><ul><li>The specific request being made to <code>apiUtil.callFooApi()</code></li><li>Error handling for the response from <code>apiUtil.callFooApi()</code>.</li></ul><p>That is, we should only be verifying (asserting) that:</p><ul><li>The <code>callFooApi()</code> method is called with the correct parameters.</li><li>When <code>callFooApi()</code> returns a <code>RestException</code>, a certain <code>FooServiceException</code> is thrown.</li><li>When the response from <code>callFooApi()</code> is null, an empty <code>Optional</code> is returned.</li></ul><p>The fact that <code>FooService.performBar()</code> outsources the <code>fizz</code> to <code>buzz</code> mapping to <code>barUtil.bar()</code> is an implementation detail. While we may very well have to mock it to ensure that an expected value is returned (you did remember to mock both the <code>BarUtil</code> and <code>ApiUtil</code>, right?), there&rsquo;s no need to explicitly assert that <code>barUtil.bar()</code> was called.</p><p>Why is this? Because a written specification for the <code>performBar()</code> method would only mention that the <code>ApiUtil</code> is called in a certain way, and that certain errors from that call are handled. The call to <code>BarUtil</code> (which we already know is free of side effects) is subject to change at a later date - it&rsquo;s a helper service used to extract some common logic from the <code>FooService</code>, but its invocation is by no means a requirement to the successful operation of the class.</p><p>Now, it may very well be that there&rsquo;s a team norm or other guideline that states, &ldquo;all <code>fizz</code> to <code>buzz</code> mapping should use the <code>BarUtil</code>&rdquo;, but a unit test is not the place to assert that. Rather, some kind of static code analysis tool like Sonar may be of use in that situation. Reliance on a unit test for such an assertion, however, is liable to fail as a control - the verification might be forgotten or incorrectly copied from elsewhere in the project. A control that is subject to human error isn&rsquo;t much of a control at all!</p><h2 id=the-bigger-picture>The Bigger Picture</h2><p>Test-Driven Development (TDD) is a practice and methodology for producing Goodâ„¢ code. It emphasizes writing tests <em>first</em>, then writing the code to satisfy the test. In doing so, the core requirements of a software project are understood and codified (literally) before doing anything else. This is in contrast to a &ldquo;code-then-test&rdquo; strategy that is more akin to double-entry bookkeeping - write the code, then &ldquo;lock it in&rdquo; with some tests.</p><p>This latter strategy is less optimal than the former. Although the engineer may enjoy protection against unintended change, the initial implementation of the code in question is done without guardrail or intent. Without first thinking about the software&rsquo;s requirements, it is entirely likely that whole swaths of unnecessary code will be written, committed, reviewed, and deployed without actually solving the original need. Meanwhile, the aspects of the code&rsquo;s functionality that we <em>do</em> care about may be forgotten entirely.</p><p>I often encounter these sorts of mistakes and flawed testing approaches during code reviews, and I can&rsquo;t help but wonder if the quality of software projects the world over might be improved drastically by adhering more strictly to TDD. It&rsquo;s not enough to simply write tests - you have to follow the process.</p><p>Until next time,<br>- Mario</p></div></article></main><footer class="fullWidth h-card"><img class=u-photo src=/profilePic.jpeg>
<span><p class=p-note>Hi, I'm Mario! Software engineering manager, actor, DIY-enthusiast. Trying new things every day and living life to the fullest!</p><p>&copy;
2023
<a class="p-name u-url u-uid" href=https://mleone.dev>Mario Leone</a>
<a class=u-url rel=me href=https://github.com/mleone10><i class="fa-brands fa-github"></i></a><a class=u-url rel=me href=https://linkedin.com/in/mleone5244><i class="fa-brands fa-linkedin"></i></a><a class=u-url rel=me href=https://hachyderm.io/@mleone><i class="fa-brands fa-mastodon"></i></a></p></span></footer></body></html>